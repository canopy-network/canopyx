global:
  storageClassName: "standard"

# Disable unnecessary HyperDX components - we only need ClickHouse
hyperdx:
  replicas: 0  # Disable the HyperDX web UI (no enabled flag available)

mongodb:
  enabled: false  # Disable MongoDB - not needed for our use case

otel:
  enabled: false  # Disable OTEL collector - not needed for our use case

clickhouse:
  # Enable automatic PVC deletion on helm uninstall
  persistentVolumeClaimRetentionPolicy:
    enabled: true
    whenDeleted: Delete  # Auto-delete PVCs when chart is uninstalled
    whenScaled: Retain   # Keep PVCs when scaling down (for data safety)

  # Prometheus scraping annotations
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9363"
    prometheus.io/path: "/metrics"

  # NOTE: HyperDX chart does NOT support extraConfigFiles or config.maxConcurrentQueries
  # To increase max_concurrent_queries, you must manually patch the ConfigMap after deployment
  # See docs/clickhouse-optimization.md for instructions

  config:
    users:
      # added this here since the latest jdbc driver does not support connect with authentication
      otelUserName: "canopyx"
      otelUserPassword: "canopyx"
    clusterCidrs:
      - "0.0.0.0/0"
    # Performance tuning for high-throughput workloads (3,500+ wf/sec)
    # Note: max_concurrent_queries MUST be set in extraConfigFiles above
    maxThreads: 16                    # Use more CPU cores
    maxInsertThreads: 8               # Parallel insert operations
    backgroundPoolSize: 32            # Background task pool
    backgroundMergesMutationsConcurrencyRatio: 4  # More concurrent merges
    maxPartsMergedAtOnce: 150         # Batch merges for efficiency
