server:
  replicaCount: 1
  config:
    namespaces:
      create: true
      namespace:
        - name: canopyx
          retention: 1d
    # Increase RPC rate limits to handle high concurrency (700k+ workflows)
    # Tuned for massive parallel block indexing workloads
    limits:
      maxIDLengthLimit: 255
      # Frontend service RPC rate limits (handles client requests)
      frontend:
        rps: 10000                   # Requests per second (default: 1200, was: 4000)
        namespaceReplicationInducingAPIsRPS: 500   # default: 20, was: 100
      # History service rate limits (workflow execution history)
      history:
        rps: 20000                   # default: 9000
      # Matching service rate limits (task queue operations - critical for high throughput)
      matching:
        rps: 15000                   # default: 1200, was: 4000 - CRITICAL for queue operations
      # Worker service rate limits
      worker:
        rps: 5000                    # default: 1000
    # Configure persistence to use PostgreSQL instead of Cassandra
    # Connection pools tuned for PostgreSQL with max_connections=300
    # Total connections: (default: 60) + (visibility: 30) = 90 per Temporal service
    # With 4 services (frontend, history, matching, worker): 90 * 4 = 360 connections needed
    # PostgreSQL max_connections=300 is tight but workable (some services use fewer connections)
    persistence:
      default:
        driver: "sql"
        sql:
          driver: "postgres12"
          host: "temporal-postgresql"
          port: 5432
          database: "temporal"
          user: "temporal"
          password: "temporal"
          maxConns: 60               # Increased from 10 (main workflow history store)
          maxIdleConns: 20           # Keep connections warm
          maxConnLifetime: "1h"
          connMaxIdleTime: "5m"      # Close idle connections after 5min
      visibility:
        driver: "sql"
        sql:
          driver: "postgres12"
          host: "temporal-postgresql"
          port: 5432
          database: "temporal_visibility"  # Separate database (fixes missing schema tables)
          user: "temporal"
          password: "temporal"
          maxConns: 30               # Increased from 5 (workflow search/filtering)
          maxIdleConns: 10
          maxConnLifetime: "1h"
          connMaxIdleTime: "5m"

prometheus:
  enabled: false

grafana:
  enabled: false

# Disable Elasticsearch - using PostgreSQL for visibility instead
elasticsearch:
  enabled: false

# Disable Cassandra
cassandra:
  enabled: false

# Disable built-in PostgreSQL (we deploy it separately via Tiltfile)
postgresql:
  enabled: false

# Schema tool configuration for PostgreSQL
schema:
  setup:
    enabled: true
    backoffLimit: 100
  update:
    enabled: true
    backoffLimit: 100