server:
  replicaCount: 1
  config:
    namespaces:
      create: true
      namespace:
        - name: canopyx
          retention: 1d
    # Increase RPC rate limits to handle high concurrency (700k+ workflows)
    # Tuned for massive parallel block indexing workloads
    limits:
      maxIDLengthLimit: 255
      # Frontend service RPC rate limits (handles client requests)
      frontend:
        rps: 10000                   # Requests per second (default: 1200, was: 4000)
        namespaceReplicationInducingAPIsRPS: 500   # default: 20, was: 100
      # History service rate limits (workflow execution history)
      history:
        rps: 20000                   # default: 9000
      # Matching service rate limits (task queue operations - critical for high throughput)
      matching:
        rps: 15000                   # default: 1200, was: 4000 - CRITICAL for queue operations
      # Worker service rate limits
      worker:
        rps: 5000                    # default: 1000
    # Configure persistence to use PostgreSQL instead of Cassandra
    # Using conservative connection pools to stay within PostgreSQL defaults (max_connections=100)
    # TODO: Increase once we tune PostgreSQL for production
    persistence:
      default:
        driver: "sql"
        sql:
          driver: "postgres12"
          host: "temporal-postgresql"
          port: 5432
          database: "temporal"
          user: "temporal"
          password: "temporal"
          maxConns: 10               # Conservative for default PostgreSQL config
          maxIdleConns: 5
          maxConnLifetime: "1h"
      visibility:
        driver: "sql"
        sql:
          driver: "postgres12"
          host: "temporal-postgresql"
          port: 5432
          database: "temporal_visibility"
          user: "temporal"
          password: "temporal"
          maxConns: 5                # Conservative for default PostgreSQL config
          maxIdleConns: 2
          maxConnLifetime: "1h"

prometheus:
  enabled: false

grafana:
  enabled: false

# Disable Elasticsearch - using PostgreSQL for visibility instead
elasticsearch:
  enabled: false

# Disable Cassandra
cassandra:
  enabled: false

# Disable built-in PostgreSQL (we deploy it separately via Tiltfile)
postgresql:
  enabled: false

# Schema tool configuration for PostgreSQL
schema:
  setup:
    enabled: true
    backoffLimit: 100
  update:
    enabled: true
    backoffLimit: 100