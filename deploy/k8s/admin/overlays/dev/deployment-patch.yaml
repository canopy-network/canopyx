# Dev environment patches for canopyx-admin
# Updates service endpoints for canopy-dev namespace
apiVersion: apps/v1
kind: Deployment
metadata:
  name: canopyx-admin
spec:
  template:
    spec:
      nodeSelector:
        node-role.kubernetes.io/control-plane: "true"
      containers:
        - name: admin
          image: docker.io/canopynetwork/canopyx-admin:latest
          imagePullPolicy: Never
          env:
            # Logging - debug for dev
            - { name: LOG_LEVEL, value: "debug" }
            # ADMIN server
            - { name: ADDR, value: ":3000" }
            - { name: ADMIN_TOKEN, value: "devtoken" }
            - { name: ADMIN_USER, value: "admin" }
            - { name: ADMIN_PASSWORD, value: "admin" }
            - { name: ADMIN_USERS, value: "" }
            - { name: SESSION_SECRET, value: "change-me-please" }
            # ClickHouse connection - dev namespace
            - { name: CLICKHOUSE_ADDR, value: "clickhouse://canopyx:canopyx@chi-canopyx-canopyx-0-0.dev.svc.cluster.local:9000" }
            - { name: CLICKHOUSE_CONN_STRATEGY, value: "in_order" }
            - { name: CLICKHOUSE_CONN_MAX_LIFETIME, value: "1h" }
            # Databases
            - { name: INDEXER_DB, value: "canopyx_indexer" }
            - { name: CROSSCHAIN_DB, value: "canopyx_cross_chain" }
            # Temporal Connection - dev namespace
            - { name: TEMPORAL_HOSTPORT, value: "temporal-frontend.dev.svc.cluster.local:7233" }
            - { name: TEMPORAL_NAMESPACE, value: "canopyx" }
            # Redis Connection - dev namespace
            - { name: REDIS_ENABLED, value: "true" }
            - { name: REDIS_HOST, value: "redis.dev.svc.cluster.local" }
            - { name: REDIS_PORT, value: "6379" }
            - { name: REDIS_PASSWORD, value: "" }
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: 1000m
              memory: 1Gi

